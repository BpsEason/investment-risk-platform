# æŠ•è³‡çµ„åˆé¢¨éšªè©•ä¼°èˆ‡å ±å‘Šå¹³å°

**å€‰åº«é€£çµ**  
https://github.com/BpsEason/investment-risk-platform.git

---

## ğŸš€ äº®é»

- AI é©…å‹•çš„ç¨‹å¼ç¢¼ç”Ÿæˆ  
  â€¢ åˆ©ç”¨ OpenAI prompts è‡ªå‹•ç”¢å‡º Django modelsã€DRF serializers/viewsetsã€FastAPI æ¸¬è©¦ã€React çµ„ä»¶ã€Flutter widgets åŠå…¶æ¸¬è©¦æª”æ¡ˆã€‚  

- å¾®æœå‹™èˆ‡æ¨¡çµ„åŒ–è¨­è¨ˆ  
  â€¢ Django è² è²¬æ ¸å¿ƒé¢¨éšªæŒ‡æ¨™è¨ˆç®—ï¼ˆVaRã€CVaRã€Sharpe Ratioï¼‰  
  â€¢ FastAPI ä½œç‚º ETL èˆ‡ API Gateway  
  â€¢ React + D3.js æä¾›äº’å‹•å¼ç¶²é å„€è¡¨æ¿  
  â€¢ Flutter è¡Œå‹•ç«¯éš¨æ™‚æŒæ¡é¢¨éšª  

- ä¸€éµå•Ÿå‹•ã€å¤šèªè¨€ç’°å¢ƒ  
  â€¢ Docker Compose ç·¨æ’ PostgreSQLã€RabbitMQã€Redisã€Djangoã€FastAPIã€Reactã€Flutter  
  â€¢ ç’°å¢ƒéš”é›¢ã€æ˜“æ–¼éƒ¨ç½²  

- å…¨é¢æ¸¬è©¦è¦†è“‹  
  â€¢ Django: `pytest` + `coverage`  
  â€¢ FastAPI: `pytest` + `TestClient`  
  â€¢ React: Jest + React Testing Library  
  â€¢ Flutter: `flutter_test` + `integration_test`  
  â€¢ Mutation Testing: Mutpy (Python) & Stryker (JavaScript)  

- CI/CD è‡ªå‹•åŒ–  
  â€¢ GitHub Actions å¯¦ç¾ç¨‹å¼ç¢¼æª¢å‡ºã€å®‰è£ä¾è³´ã€è·‘æ¸¬è©¦ã€ç”¢ç”Ÿè¦†è“‹ç‡å ±å‘Šã€ä¸¦ä¸Šå‚³ Codecov  
  â€¢ éƒ¨ç½²å‰è‡ªå‹•æª¢æŸ¥ Swagger / Redoc æ–‡æª”å¯ç”¨æ€§  

---

## ğŸ— ç³»çµ±æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Web â”‚â—€â”€â”€â”€APIâ”€â”€â–¶â”‚   Django     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ Microservice â”‚
      â–²                 â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚
      â”‚                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flutter    â”‚â—€â”€â”€â”€APIâ”€â”€â–¶â”‚  FastAPI     â”‚
â”‚ Mobile App â”‚          â”‚ ETL & Gatewayâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚
      â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL â”‚          â”‚ RabbitMQ +   â”‚
â”‚   Database â”‚          â”‚ Redis / Celeryâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›  æŠ€è¡“æ£§

### å¾Œç«¯

- Django 4.x + Django REST Framework  
- FastAPI + Uvicorn  
- PostgreSQL  
- RabbitMQ + Celery + Redis  
- OpenAI API

### å‰ç«¯

- React 18 + Redux + D3.js + Tailwind CSS  
- Flutter + Provider

### DevOps & CI/CD

- Docker Compose  
- GitHub Actions  
- Codecov  
- Mutpy & Stryker

---

## âš¡ï¸ å¿«é€Ÿå•Ÿå‹•

1. Clone å€‰åº«  
   ```bash
   git clone https://github.com/BpsEason/investment-risk-platform.git
   cd investment-risk-platform
   ```

2. è¤‡è£½ `.env` ä¸¦è¨­å®š  
   ```bash
   cp .env.example .env
   # ç·¨è¼¯ .env å¡«å…¥ OPENAI_API_KEYã€è³‡æ–™åº«èˆ‡ broker è³‡è¨Š
   ```

3. å•Ÿå‹•æ•´å€‹æœå‹™  
   ```bash
   docker-compose up -d
   ```

4. åŸ·è¡Œ Django é·ç§»ä¸¦å»ºç«‹ç®¡ç†å“¡å¸³è™Ÿ  
   ```bash
   docker-compose exec django_app python manage.py makemigrations risk_metrics
   docker-compose exec django_app python manage.py migrate
   docker-compose exec django_app python manage.py createsuperuser
   ```

5. ï¼ˆé¸ç”¨ï¼‰è¨­å®š Tailwind CSS  
   ```bash
   cd frontend-react
   npm install -D tailwindcss postcss autoprefixer
   npx tailwindcss init -p
   # ä¿®æ”¹ tailwind.config.js æ‰«æ srcï¼Œä¸¦åœ¨ src/index.css æ’°å¯« Tailwind æŒ‡ä»¤
   ```

6. å­˜å–æœå‹™  
   - React ç¶²é ï¼š http://localhost:3000  
   - Django Adminï¼š http://localhost:8000/admin  
   - DRF Swaggerï¼š http://localhost:8000/swagger/  
   - FastAPI Docsï¼š http://localhost:8001/docs  

---

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

```
investment-risk-platform/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ django_risk_app/         # Django é¢¨éšªæŒ‡æ¨™å¾®æœå‹™
â”‚   â””â”€â”€ fastapi_etl_service/     # ETL èˆ‡ API Gateway
â”œâ”€â”€ frontend-react/              # React ç¶²é ç«¯
â”œâ”€â”€ flutter-app/                 # Flutter è¡Œå‹•ç«¯
â”œâ”€â”€ .github/workflows/           # CI/CD Pipeline
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ generate_ai_code.py          # AI ä»£ç¢¼è‡ªå‹•ç”Ÿæˆå¼•æ“
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

---

## ğŸ— é—œéµç¨‹å¼ç¢¼ç¤ºä¾‹ï¼ˆé™„ä¸­æ–‡è¨»è§£ï¼‰

### Django Model ç¯„ä¾‹

```python
# backend/django_risk_app/risk_metrics/models.py

import uuid
from django.db import models
from django.utils import timezone

class PortfolioRisk(models.Model):
    """
    æŠ•è³‡çµ„åˆé¢¨éšªæ¨¡å‹ï¼Œå„²å­˜æ¯æ¬¡é¢¨éšªè¨ˆç®—çµæœ
    """
    portfolio_id = models.UUIDField(
        primary_key=True,
        default=uuid.uuid4,
        editable=False,
        verbose_name="æŠ•è³‡çµ„åˆ ID"
    )
    metric = models.CharField(
        max_length=100,
        verbose_name="é¢¨éšªæŒ‡æ¨™åç¨±"
    )
    value = models.FloatField(
        verbose_name="æŒ‡æ¨™æ•¸å€¼"
    )
    calculated_at = models.DateTimeField(
        auto_now_add=True,
        verbose_name="è¨ˆç®—æ™‚é–“"
    )

    class Meta:
        verbose_name = "æŠ•è³‡çµ„åˆé¢¨éšª"
        verbose_name_plural = "æŠ•è³‡çµ„åˆé¢¨éšª"
        unique_together = ('portfolio_id', 'metric')  # åŒä¸€æŠ•è³‡çµ„åˆåŒä¸€æŒ‡æ¨™åªèƒ½æœ‰ä¸€ç­†

    def __str__(self):
        # å›å‚³ã€ŒID â€“ æŒ‡æ¨™ã€æ–¹ä¾¿ç®¡ç†ä»‹é¢é¡¯ç¤º
        return f"{self.portfolio_id} â€“ {self.metric}"
```

### FastAPI è¨ˆç®—ç«¯é»

```python
# backend/fastapi_etl_service/main.py

@app.post("/calculate-risk", response_model=RiskCalculationResponse)
async def calculate_risk(request: RiskCalculationRequest):
    """
    æ ¹æ“šå‚³å…¥çš„åƒ¹æ ¼æ­·å²æ•¸æ“šè¨ˆç®—æŒ‡å®šé¢¨éšªæŒ‡æ¨™ï¼ˆVaRã€CVaRã€Sharpe Ratioï¼‰
    """
    # é©—è­‰è¼¸å…¥æ˜¯å¦å­˜åœ¨
    if not request.data:
        raise HTTPException(status_code=400, detail="è«‹æä¾›è¦è¨ˆç®—çš„æ•¸æ“šã€‚")

    # å°‡åƒ¹æ ¼åˆ—è¡¨è½‰ç‚º pandas Seriesï¼Œè¨ˆç®—æ—¥æ”¶ç›Šç‡
    prices = pd.Series(d["price"] for d in request.data)
    returns = prices.pct_change().dropna()
    if returns.empty:
        raise HTTPException(status_code=400, detail="æ•¸æ“šä¸è¶³ä»¥è¨ˆç®—æ”¶ç›Šç‡ã€‚")

    # æ ¹æ“š metric é¡å‹åˆ‡æ›è¨ˆç®—
    if request.metric == "VaR":
        cl = request.parameters.get("confidence_level", 0.95)
        losses = -returns.sort_values().values
        idx = int(len(losses) * (1 - cl))
        result = losses[idx]
        description = f"æ­·å²æ¨¡æ“¬æ³• VaR ({cl*100:.1f}%)"
        unit = "%"
    elif request.metric == "CVaR":
        cl = request.parameters.get("confidence_level", 0.95)
        losses = -returns.sort_values().values
        idx = int(len(losses) * (1 - cl))
        result = losses[idx:].mean() if len(losses) > idx else 0.0
        description = f"æ­·å²æ¨¡æ“¬æ³• CVaR ({cl*100:.1f}%)"
        unit = "%"
    elif request.metric == "Sharpe Ratio":
        rf = request.parameters.get("risk_free_rate", 0.0)
        mean_ret = returns.mean()
        std_ret = returns.std()
        result = (mean_ret - rf) / std_ret if std_ret else 0.0
        description = "åŸºæ–¼æ­·å²æ”¶ç›Šç‡çš„ Sharpe Ratio"
        unit = "ratio"
    else:
        raise HTTPException(status_code=400, detail=f"ä¸æ”¯æ´çš„æŒ‡æ¨™ï¼š{request.metric}")

    return RiskCalculationResponse(
        metric=request.metric,
        value=float(result),
        unit=unit,
        description=description
    )
```

### React é¡¯ç¤ºçµ„ä»¶

```jsx
// frontend-react/src/components/PortfolioRiskDisplay.js

import React from 'react';

/**
 * PortfolioRiskDisplay
 * @param {{ metric: string, value: number }[]} riskData - é¢¨éšªæ•¸æ“šé™£åˆ—
 */
function PortfolioRiskDisplay({ riskData }) {
  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      {riskData.map(({ metric, value }) => (
        <div key={metric} className="p-4 bg-white rounded shadow">
          <h3 className="text-xl font-semibold">{metric}</h3>
          <p className="mt-2 text-3xl text-blue-500">
            {(metric === 'Sharpe Ratio' ? value.toFixed(2) : (value * 100).toFixed(2) + '%')}
          </p>
        </div>
      ))}
    </div>
  );
}

export default PortfolioRiskDisplay;
```

### Flutter Widget ç¯„ä¾‹

```dart
// flutter-app/lib/widgets/risk_metric_card.dart

import 'package:flutter/material.dart';

/**
 * RiskMetricCard
 * é¡¯ç¤ºå–®å€‹é¢¨éšªæŒ‡æ¨™çš„å¡ç‰‡
 */
class RiskMetricCard extends StatelessWidget {
  final String metric;
  final double value;

  const RiskMetricCard({
    Key? key,
    required this.metric,
    required this.value,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    // Card åŒ…è£¹ ListTileï¼Œæ¨™é¡Œé¡¯ç¤ºæŒ‡æ¨™åç¨±ï¼Œå³å´é¡¯ç¤ºæŒ‡æ¨™æ•¸å€¼
    return Card(
      margin: const EdgeInsets.symmetric(vertical: 8),
      child: ListTile(
        title: Text(metric, style: const TextStyle(fontSize: 18)),
        trailing: Text(
          // è‹¥ä¸æ˜¯æ¯”ç‡å‰‡è½‰ç‚ºç™¾åˆ†æ¯”é¡¯ç¤º
          metric == 'Sharpe Ratio'
            ? value.toStringAsFixed(2)
            : '${(value * 100).toStringAsFixed(2)}%',
          style: const TextStyle(fontSize: 20, color: Colors.blue),
        ),
      ),
    );
  }
}
```

---

## ğŸ¤ è²¢ç»æŒ‡å—

1. Fork æœ¬å°ˆæ¡ˆ  
2. å»ºç«‹ feature branch (`git checkout -b feat/your-feature`)  
3. Commit ä¸¦ push (`git commit -m "feat: add new feature"`ï¼›`git push`)  
4. é–‹ PRï¼Œå¾…é€šéæ¸¬è©¦èˆ‡å¯©æŸ¥å¾Œåˆä½µ  

---

## ğŸ“„ æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT Licenseï¼Œè©³è¦‹ [LICENSE](LICENSE)ã€‚

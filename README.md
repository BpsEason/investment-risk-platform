# AI é©…å‹•çš„æŠ•è³‡çµ„åˆé¢¨éšªè©•ä¼°èˆ‡å ±å‘Šå¹³å°

[![AI-Powered](https://img.shields.io/badge/AI-Powered-OpenAI-blue)]()

---

## ğŸš€ å°ˆæ¡ˆåŠŸèƒ½

- **è‡ªå‹•åŒ–é¢¨éšªè¨ˆç®—**  
  æ”¯æ´ VaRã€CVaRã€Sharpe Ratioï¼Œçµåˆæ­·å²æ¨¡æ“¬èˆ‡çµ±è¨ˆæ–¹æ³•ï¼Œä¸€éµå–å›æ ¸å¿ƒæŒ‡æ¨™ã€‚

- **AI é©…å‹•ç¨‹å¼ç¢¼ç”Ÿæˆ**  
  åˆ©ç”¨ `generate_ai_code.py` æ­é… OpenAI APIï¼Œè‡ªå‹• scaffold å¾Œç«¯æ¨¡å‹ã€APIã€å‰ç«¯çµ„ä»¶ã€è¡Œå‹•ç«¯ Widget åŠå°æ‡‰æ¸¬è©¦ã€‚

- **äº’å‹•å¼ API æ–‡ä»¶**  
  - Django REST Framework + drf-yasgï¼š`/swagger/`ã€`/redoc/`  
  - FastAPI åŸç”Ÿï¼š`/docs`ã€`/redoc`

- **å¤šç«¯å¯è¦–åŒ–å±•ç¤º**  
  - **React + D3.js**ï¼šå‹•æ…‹é•·æ¢åœ–  
  - **Flutter**ï¼šå¡ç‰‡å¼é¢¨éšªæŒ‡æ¨™

- **å¾®æœå‹™ ï¼‹ å®¹å™¨åŒ–**  
  Docker Compose ä¸€éµå•Ÿå‹• PostgreSQLã€RabbitMQã€Redisã€Djangoã€FastAPIã€Reactã€Flutter

- **å…¨é¢æ¸¬è©¦ ï¼† CI/CD**  
  - å–®å…ƒã€é›†æˆã€E2E æ¸¬è©¦  
  - Mutation Testing (Mutpyã€Stryker)  
  - GitHub Actions è‡ªå‹•è·‘æ¸¬è©¦ã€ä¸Šå‚³ Codecov

---

## ğŸ—º ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Web   â”‚â—€â”€â”€â”€â”€â”€â”€â–¶â”‚   Django     â”‚
â”‚ + D3.js åœ–è¡¨ â”‚       â”‚ é¢¨éšªè¨ˆç®—å¾®æœå‹™ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â–²                        â”‚
        â”‚                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flutter App  â”‚â—€â”€â”€â”€â”€â”€â”€â–¶â”‚   FastAPI    â”‚
â”‚ (è¡Œå‹•ç«¯ UI)   â”‚       â”‚ ETL ï¼† Gatewayâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚
        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚       â”‚ RabbitMQ ï¼‹  â”‚
â”‚ (è³‡æ–™åº«)      â”‚       â”‚ Redis / Celeryâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›  æŠ€è¡“æ£§

- **å¾Œç«¯**ï¼šDjango 4.x, DRF, FastAPI, Celery, PostgreSQL, RabbitMQ, Redis  
- **å‰ç«¯**ï¼šReact 18, Redux, D3.js, Tailwind CSS  
- **è¡Œå‹•ç«¯**ï¼šFlutter, Provider  
- **è‡ªå‹•åŒ–**ï¼šDocker Compose, GitHub Actions, Codecov  
- **AI ç”Ÿæˆ**ï¼šOpenAI API via `generate_ai_code.py`  

---

## âš¡ï¸ å¿«é€Ÿå•Ÿå‹•

1. è¤‡è£½ä¸¦ç·¨è¼¯ç’°å¢ƒè¨­å®š  
   ```bash
   cp .env.example .env
   # å¡«å…¥ OPENAI_API_KEYã€è³‡æ–™åº«èˆ‡ Broker è³‡è¨Š
   ```

2. å•Ÿå‹•æ‰€æœ‰æœå‹™  
   ```bash
   docker-compose up -d
   ```

3. åˆå§‹åŒ– Django  
   ```bash
   docker-compose exec django_app python manage.py makemigrations risk_metrics
   docker-compose exec django_app python manage.py migrate
   docker-compose exec django_app python manage.py createsuperuser
   ```

4. ï¼ˆé¸ç”¨ï¼‰å®‰è£ React Tailwind CSS  
   ```bash
   cd frontend-react
   npm install -D tailwindcss postcss autoprefixer
   npx tailwindcss init -p
   ```

5. å­˜å–æ‡‰ç”¨  
   - **React ç¶²é **ï¼šhttp://localhost:3000  
   - **Django Admin**ï¼šhttp://localhost:8000/admin  
   - **DRF Swagger**ï¼šhttp://localhost:8000/swagger/  
   - **FastAPI Docs**ï¼šhttp://localhost:8001/docs  

---

## ğŸ§  AI ä»£ç¢¼ç”Ÿæˆ & Prompt ä½¿ç”¨èªªæ˜

æœ¬å°ˆæ¡ˆå°‡ã€Œæ„åœ–é©…å‹•ã€çš„ prompt å­˜æ”¾æ–¼å°ˆæ¡ˆç›®éŒ„ä¸‹ï¼Œæ­é… `generate_ai_code.py` è‡ªå‹•ç”¢ç”Ÿç¨‹å¼éª¨æ¶èˆ‡æ¸¬è©¦ï¼š

### 1. Prompt ç›®éŒ„çµæ§‹

- `backend/prompts/`  
  - `django_models_prompt.txt`  
  - `django_serializers_prompt.txt`  
  - `django_views_prompt.txt`  
  - `django_models_test_prompt.txt`  
  - `...`

- `frontend-react/prompts/`  
  - `react_component_prompt.txt`  
  - `react_component_test_prompt.txt`

- `flutter-app/prompts/`  
  - `flutter_widget_prompt.txt`  
  - `flutter_widget_test_prompt.txt`

### 2. ç·¨è¼¯ Prompt

æ‰“é–‹å°æ‡‰ `.txt` æª”ï¼Œä¿®æ”¹æˆ–è£œå……éœ€æ±‚æè¿°ï¼Œä¾‹å¦‚ï¼š

```txt
# backend/prompts/django_models_prompt.txt
è«‹ç”Ÿæˆ Django model å®šç¾©æª”ï¼Œåç¨±ç‚º PortfolioRiskã€‚
æ¬„ä½æœ‰ï¼š
- portfolio_id (UUIDField...)
- metric (CharField...)
...
```

### 3. åŸ·è¡Œç”Ÿæˆ

```bash
# ç”Ÿæˆ Django Model
python generate_ai_code.py django_models

# ç”Ÿæˆ React çµ„ä»¶
python generate_ai_code.py react_component

# ç”Ÿæˆ FastAPI æ¸¬è©¦
python generate_ai_code.py fastapi_main_test
```

> **å¯ç”¨ç”Ÿæˆé¡å‹**  
> `django_models`, `django_serializers`, `django_views`, `django_urls`,  
> `django_models_test`, `django_serializers_test`, `django_views_test`,  
> `fastapi_main_test`,  
> `react_component`, `react_component_test`,  
> `flutter_widget`, `flutter_widget_test`

### 4. å¯©é–±èˆ‡å•Ÿç”¨

ç”Ÿæˆå¾Œæœƒåœ¨ç›®æ¨™æª”æ¡ˆé ‚éƒ¨ï¼åº•éƒ¨åŠ å…¥ï¼š

```python
# AI ç”Ÿæˆç¨‹å¼ç¢¼é–‹å§‹
# è«‹å¯©é–±å¾Œç§»é™¤è¨»è§£ä¸¦ä½¿ç”¨
â€¦
# AI ç”Ÿæˆç¨‹å¼ç¢¼çµæŸ
```

å¯©é–±å…§å®¹ç„¡èª¤å¾Œï¼Œç§»é™¤é€™äº›æ¨™è¨˜è¨»è§£ï¼Œå³å¯æ­£å¼å•Ÿç”¨è‡ªå‹•ç”Ÿæˆçš„ç¨‹å¼ç¢¼ã€‚

---

## ğŸ” å¸¸è¦‹å•é¡Œ (FAQ)

1. **æ€éº¼æ–°å¢è‡ªè¨‚é¢¨éšªæŒ‡æ¨™ï¼Ÿ**  
   ç·¨è¼¯ `backend/fastapi_etl_service/main.py` ä¸­çš„ `/calculate-risk` åˆ†æ”¯ï¼Œå¯¦ä½œæ–°çš„æŒ‡æ¨™è¨ˆç®—ï¼›åŒæ­¥æ–°å¢å°æ‡‰æ¸¬è©¦ã€‚

2. **å¦‚ä½•èª¿æ•´ Promptï¼Ÿ**  
   ä¿®æ”¹ `*/prompts/*.txt`ï¼Œç„¶å¾Œé‡è·‘ `generate_ai_code.py <é¡å‹>` å³å¯ã€‚

3. **å¦‚ä½•æ•´åˆåˆ°ç¾æœ‰ CI/CDï¼Ÿ**  
   åƒè€ƒ `.github/workflows/main.yml`ï¼Œå°‡å®‰è£ä¾è³´ã€é·ç§»ã€æ¸¬è©¦ã€è¦†è“‹ç‡ã€Documentation æª¢æŸ¥ç­‰æ­¥é©Ÿç´å…¥æ—¢æœ‰æµæ°´ç·šã€‚

4. **Mutation Testing æ€éº¼ç”¨ï¼Ÿ**  
   - Pythonï¼š`mut.py backend/django_risk_app/risk_metrics`  
   - JavaScriptï¼š`npx stryker run`

5. **å¦‚ä½•å®‰å…¨ç®¡ç†æ©Ÿå¯†ï¼Ÿ**  
   å»ºè­°æ¡ç”¨é›²ç«¯ Secret Manager æˆ– Kubernetes Secretï¼Œé¿å…å°‡çœŸå¯¦æ†‘è­‰æäº¤è‡³ç‰ˆæœ¬åº«ã€‚

---

## ğŸ”‘ é—œéµç¨‹å¼ç¢¼ç¯„ä¾‹

### 1. Django Model

```python
# backend/django_risk_app/risk_metrics/models.py

import uuid
from django.db import models

class PortfolioRisk(models.Model):
    # ä¸»éµï¼šä½¿ç”¨ UUIDï¼Œè‡ªå‹•ç”Ÿæˆ
    portfolio_id = models.UUIDField(
        primary_key=True,
        default=uuid.uuid4,
        editable=False,
        verbose_name="æŠ•è³‡çµ„åˆ ID"
    )
    # é¢¨éšªæŒ‡æ¨™åç¨±
    metric = models.CharField(max_length=100, verbose_name="é¢¨éšªæŒ‡æ¨™")
    # æŒ‡æ¨™æ•¸å€¼
    value = models.FloatField(verbose_name="æŒ‡æ¨™æ•¸å€¼")
    # è‡ªå‹•å¡«å…¥è¨ˆç®—æ™‚é–“
    calculated_at = models.DateTimeField(auto_now_add=True, verbose_name="è¨ˆç®—æ™‚é–“")

    class Meta:
        unique_together = ("portfolio_id", "metric")  # åŒä¸€çµ„åˆåŒä¸€æŒ‡æ¨™ä¸å¯é‡è¤‡
        verbose_name = "æŠ•è³‡çµ„åˆé¢¨éšª"
        verbose_name_plural = "æŠ•è³‡çµ„åˆé¢¨éšª"

    def __str__(self):
        # ç®¡ç†ä»‹é¢é¡¯ç¤ºï¼šUUID â€“ æŒ‡æ¨™
        return f"{self.portfolio_id} â€“ {self.metric}"
```

---

### 2. FastAPI è¨ˆç®—ç«¯é»

```python
# backend/fastapi_etl_service/main.py

from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import pandas as pd

app = FastAPI()

class RiskCalculationRequest(BaseModel):
    data: list[dict[str, float]]
    metric: str
    parameters: dict[str, float] = {}

class RiskCalculationResponse(BaseModel):
    metric: str
    value: float
    unit: str
    description: str

@app.post("/calculate-risk", response_model=RiskCalculationResponse)
async def calculate_risk(req: RiskCalculationRequest):
    # é©—è­‰è¼¸å…¥
    if not req.data:
        raise HTTPException(400, "è«‹æä¾›åƒ¹æ ¼æ•¸æ“šã€‚")

    # å»ºç«‹æ”¶ç›Šç‡åºåˆ—
    prices = pd.Series(item["price"] for item in req.data)
    returns = prices.pct_change().dropna()
    if returns.empty:
        raise HTTPException(400, "æ•¸æ“šä¸è¶³ä»¥è¨ˆç®—æ”¶ç›Šç‡ã€‚")

    # è¨ˆç®—é‚è¼¯
    if req.metric == "VaR":
        cl = req.parameters.get("confidence_level", 0.95)
        losses = -returns.sort_values().values
        idx = int(len(losses)*(1-cl))
        val = losses[idx]
        unit = "%"
    elif req.metric == "CVaR":
        cl = req.parameters.get("confidence_level", 0.95)
        losses = -returns.sort_values().values
        idx = int(len(losses)*(1-cl))
        val = losses[idx:].mean() if len(losses)>idx else 0.0
        unit = "%"
    elif req.metric == "Sharpe Ratio":
        rf = req.parameters.get("risk_free_rate", 0.0)
        mean = returns.mean()
        std = returns.std()
        val = (mean - rf)/std if std else 0.0
        unit = "ratio"
    else:
        raise HTTPException(400, f"ä¸æ”¯æ´çš„æŒ‡æ¨™ï¼š{req.metric}")

    return RiskCalculationResponse(
        metric=req.metric,
        value=float(val),
        unit=unit,
        description=f"{req.metric} è¨ˆç®—å®Œæˆ"
    )
```

---

### 3. React é¡¯ç¤ºçµ„ä»¶

```jsx
// frontend-react/src/components/PortfolioRiskDisplay.js

import React from 'react';

/**
 * é¢¨éšªæŒ‡æ¨™é¡¯ç¤ºå…ƒä»¶
 * @param {{ metric: string, value: number }[]} riskData
 */
function PortfolioRiskDisplay({ riskData }) {
  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      {riskData.map(({ metric, value }) => (
        <div key={metric} className="p-4 bg-white rounded shadow">
          <h3 className="text-xl font-semibold">{metric}</h3>
          <p className="mt-2 text-3xl text-blue-500">
            {metric === "Sharpe Ratio"
              ? value.toFixed(2)
              : `${(value * 100).toFixed(2)}%`}
          </p>
        </div>
      ))}
    </div>
  );
}

export default PortfolioRiskDisplay;
```

---

### 4. Flutter Widget

```dart
// flutter-app/lib/widgets/risk_metric_card.dart

import 'package:flutter/material.dart';

/// é¡¯ç¤ºå–®ä¸€é¢¨éšªæŒ‡æ¨™çš„å¡ç‰‡
class RiskMetricCard extends StatelessWidget {
  final String metric;
  final double value;

  const RiskMetricCard({
    Key? key,
    required this.metric,
    required this.value,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Card(
      margin: const EdgeInsets.symmetric(vertical: 8),
      child: ListTile(
        title: Text(metric, style: const TextStyle(fontSize: 18)),
        trailing: Text(
          metric == 'Sharpe Ratio'
              ? value.toStringAsFixed(2)
              : '${(value * 100).toStringAsFixed(2)}%',
          style: const TextStyle(fontSize: 20, color: Colors.blue),
        ),
      ),
    );
  }
}
```

---

## ğŸ¤ è²¢ç»èˆ‡æˆæ¬Š

æ­¡è¿é–‹å•Ÿ Issue æˆ– Pull Requestã€‚  
æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT Licenseï¼Œè©³è¦‹ [LICENSE](LICENSE)ã€‚  

---

ç¥é–‹ç™¼é †åˆ©ï¼Œç›¡æƒ…é«”é©— **AI é©…å‹•** çš„å…¨æµç¨‹é–‹ç™¼ï¼
